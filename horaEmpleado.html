  <!DOCTYPE html>
  <html>
  <head>
    <meta charset="utf-8">
  	<title>Nomina - Registro empleados</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
   <link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css" rel="stylesheet">

  <script type="javascript">



  function right(e) {

  if (navigator.appName == 'Netscape' && 

  (e.which == 3 || e.which == 2))

  return false;

  else if (navigator.appName == 'Microsoft Internet Explorer' && 

  (event.button == 2 || event.button == 3)) {

  alert("Lo sentimos, el botón derecho del ratón está inhabilitado");

  return false;

  }

  return true;

  }

  document.onmousedown=right;

  if (document.layers) window.captureEvents(Event.MOUSEDOWN);

  window.onmousedown=right;

  // End -->

  </script>

  </head>
  <body >

  <div class="container">
     <div class="row">
        <div class="col-sm-12">
          <div class="text-center">
          <img src="https://i2.wp.com/www.nominapro.mx/wp-content/uploads/2017/01/Qu%C3%A9-es-la-Maquila-de-N%C3%B3mina.png?w=1080&ssl=1" width="250px" height="250px" id="avatar">       
          </div>
           
        </div>
      </div> 
      <h3>Registro horas laboradas empleado</h3>
      <div class="form-group">
        <label for="exampleInputEmail1">Empleado *</label>
        <select class="form-control" id="empleadoslist">
          <option>Empleado</option>
        </select>
        <small id="emailHelp" class="form-text text-muted">Selecciona el  empleado al que desea registrar su jornada laboral</small>
      </div>
      <div class="row">
      <div class="col-sm-12 col-md-6 col-lg-6">
        <label for="exampleInputEmail1">Año *</label>
        <select class="form-control" id="anio">
          <option value="2016">2016</option>
          <option value="2017">2017</option>
          <option value="2018">2018</option>
          <option value="2019">2019</option>
          <option value="2020">2020</option>
        </select>
        <small id="emailHelp" class="form-text text-muted">Selecciona el  año al cuál desea realizar el registro del empleado</small>
      </div>

      <div class="col-sm-12 col-md-6 col-lg-6">
        <label for="exampleInputEmail1">Mes *</label>
        <select class="form-control" id="mes">
          <option value="Enero">Enero</option>
          <option value="Febrero">Febrero</option>
          <option value="Marzo">Marzo</option>
          <option value="Abril">Abril</option>
          <option value="Junio">Junio</option>
          <option value="Julio">Julio</option>
          <option value="Agosto">Agosto</option>
          <option value="Septiembre">Septiembre</option>
          <option value="Octubre">Octubre</option>
          <option value="Noviembre">Noviembre</option>
          <option value="Diciembre">Diciembre</option>
        </select>
        <small id="emailHelp" class="form-text text-muted">Selecciona el  mes al cuál desea realizar el registro del empleado</small>
      </div>
    </div>
    <br>
    <div >
      <small class="alert alert-info"> Tenga presente que al precionar  REGISTRAR HORAS EMPLEADO este registro esta ligado al empleado, año y mes seleccionado el cuál podrá consultar posteriormente.</small>

    </div>
    <br>
      <table  class="table table-responsive table-striped table-bordered">
        <tr>
          <th>C</th>
          <th>CF</th>
           <th>M</th> 
          <th>TD</th>
          <th>N</th>
          <th>NFS</th>
          <th>T</th>
          <th>TF</th>
          <th>CD</th>       
          <th>NS</th>
          <th>MD</th>
          <th>NDS</th>
          <th>NDF</th>
          <th>MF</th>        
        </tr>
        <tr>
          <td><input type="number" id="c" class="form-control" value="0" min="0"></td>
          <td><input type="number" id="cf" class="form-control" value="0" min="0"></td>
           <td><input type="number" id="m" class="form-control" value="0" min="0"></td>
          <td><input type="number" id="td" class="form-control" value="0" min="0"></td>
          <td><input type="number" id="n" class="form-control" value="0" min="0"></td>
          <td><input type="number" id="nfs" class="form-control" value="0" min="0"></td>
          <td><input type="number" id="t" class="form-control" value="0" min="0"></td>
          <td><input type="number" id="tf" class="form-control" value="0" min="0"></td>
          <td><input type="number" id="cd" class="form-control" value="0" min="0"></td>
          <td><input type="number" id="ns" class="form-control" value="0" min="0"></td>
          <td><input type="number" id="md" class="form-control" value="0" min="0"></td>
          <td><input type="number" id="nds" class="form-control" value="0" min="0"></td>
          <td><input type="number" id="ndf" class="form-control" value="0" min="0"></td>
          <td><input type="number" id="mf" class="form-control" value="0" min="0"></td>
           
        </tr>
         
      </table>
        <div class="row">
      <div class="col-sm-12">
        <div class="text-center">
        <button onclick="save();" class="btn btn-info btn-lg">Registrar horas empleado</button>
        </div>
      </div>
    </div>
  </div>

   <script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/1/jquery.min.js"></script>

   
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
       <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>

  <script type="text/javascript" src="https://npmcdn.com/parse/dist/parse.min.js"></script>
   
   

  <script type="text/javascript">
  	 var arrayEmpleado=[];
  	 var valorHora=0;
     var empleadoId='';
             
    $(document).ready(function(){
      Parse.initialize("88438afa-86ec-4e8a-9a52-e29b18cea22d");
     Parse.serverURL = 'https://parse.buddy.com/parse/'; 

      var Empleado = Parse.Object.extend("Empleado");
      var query = new Parse.Query(Empleado);     
      query.find({
        success: function(results) {        
          
          var listItems = '<option selected="selected" value="0">- Seleccionar empleado -</option>';
          for (var i = 0; i < results.length; i++) {
           var  object = results[i];           
            listItems += "<option value='" + object.id + "'>" + object.get('nombre')+ ' ' + object.get('apellido') + ' ( ' + object.get('cedula') + ' ) '+ "</option>";
            arrayEmpleado[i] = {
              id:object.id,
              nombre:object.get('nombre') + ' ' +object.get('apellido'),
              salario:object.get('valorHora') 
            };
          }
          $("#empleadoslist").html(listItems);
        },
        error: function(error) {
          alert("Error: " + error.code + " " + error.message);
        }
      });
       
     });
    $('select#empleadoslist').on('change', function() {
      $.each(arrayEmpleado, function(i, item) {
        valorHora = parseInt(item.salario);   
        empleadoId=item.id;
      });
     
       
    })
      
  	function save() { 

      var selectEmpleado= $('#empleadoslist').val();
      var ano= $('#anio').val();
      var mes= $('#mes').val();
      if(selectEmpleado.length <=1 )
      {
         toastr.error('Error!', 'Debe seleccionar un empleado!', {timeOut: 5000})
      }else {

        var CNomalOcho = valorHora * 8;
        var CFNomalOcho = (valorHora * 8) + (( 8 * valorHora ) * 0.75);      
        var TDNormal = (valorHora * 6) + ((6 * valorHora ) * 0.75); 
        var NNormal  = valorHora * 2;
        var NFSNormal = (valorHora *2) + ((valorHora * 2) *0.75 );
        var TNormal = valorHora * 6;
        var TFNormal = (valorHora *6) + ((valorHora * 6) *0.75 );
        var CDNormal = (valorHora * 8) + (( 8 * valorHora ) * 0.75); 
        var NDFNormal = (valorHora * 3) + (( 3 * valorHora ) * 0.35); 
        var NSNormal = (valorHora * 2) + (( 2 * valorHora ) * 0.75);
        var MDNormal = (valorHora * 8) + (( 8 * valorHora ) * 0.75);
        var NDFL = (valorHora * 2) + (( 2 * valorHora ) * 0.75);
        var NDF =(valorHora * 2) + (( 2 * valorHora ) * 0.75);
        var MFNormal = (valorHora * 8) + (( 8 * valorHora ) * 0.75);
        var c = (CNomalOcho * parseInt($("#c").val())) + ((4 * valorHora) +  ((4 * valorHora) * 0.25))*parseInt($("#c").val());
        var cf = (CFNomalOcho * parseInt($("#cf").val())) + ((4 * valorHora) +  ((4 * valorHora) * 0.1)) * parseInt($("#cf").val());
        var m= (valorHora * 8) * parseInt($("#m").val());
        var td = (TDNormal * parseInt($("#td").val()));
        var n =(NNormal *  parseInt($("#n").val())) +  ((valorHora * 6) + ((6 * valorHora ) * 0.35)) * parseInt($("#n").val()) + ((valorHora * 1) + ((1 * valorHora)* 0.25)) *  parseInt($("#n").val())+ ((valorHora * 3) + ((3 * valorHora)* 0.75)) *  parseInt($("#n").val());

        var nfs= (NFSNormal *  parseInt($("#nfs").val()))  +  ((valorHora * 3) + ((3 * valorHora ) * 1.1)) * parseInt($("#nfs").val()) + ((valorHora * 3) + ((3 * valorHora)* 0.35)) *  parseInt($("#nfs").val())+ ((valorHora * 3) + ((3 * valorHora)* 0.75)) *  parseInt($("#nfs").val()) + ((valorHora * 1) + ((1 * valorHora)* 0.25)) *  parseInt($("#nfs").val());
        var t =TNormal * parseInt($("#t").val());
        var tf =TFNormal * parseInt($("#tf").val());
        var cd =(CDNormal * parseInt($("#cd").val())) + ((valorHora * 4) + ((4 * valorHora ) * 1)) * parseInt($("#cd").val()) 
        var ns= (NSNormal *  parseInt($("#ns").val()))  +  ((valorHora * 3) + ((3 * valorHora ) * 1.1)) * parseInt($("#ns").val()) + ((valorHora * 2) + ((2 * valorHora)* 1.5)) *  parseInt($("#ns").val())+ ((valorHora * 1) + ((1 * valorHora)* 0.25)) *  parseInt($("#ns").val());
        var md = MDNormal * parseInt($("#md").val());
        var nds= (NDFL *  parseInt($("#nds").val()))  +  ((valorHora * 6) + ((6 * valorHora ) * 1.1)) * parseInt($("#nds").val()) + ((valorHora * 3) + ((3 * valorHora)* 1.5)) *  parseInt($("#nds").val())+ ((valorHora * 1) + ((1 * valorHora)* 0.75)) *  parseInt($("#nds").val());
        var ndf= (NDF *  parseInt($("#ndf").val()))  +  ((valorHora * 6) + ((6 * valorHora ) * 1.1)) * parseInt($("#ndf").val()) + ((valorHora * 3) + ((3 * valorHora)* 1.5)) *  parseInt($("#ndf").val())+ ((valorHora * 1) + ((1 * valorHora)* 0.75)) *  parseInt($("#ndf").val());
        var mf = MFNormal *  parseInt($("#mf").val());
      
          
            var Empleado = Parse.Object.extend("Empleado");      
            var pointer = Empleado.createWithoutData(empleadoId); 

            var Nomina = Parse.Object.extend("Nomina");
            var salario = new Nomina();
            var total = c+cf+m+td+n+nfs+t+tf+cd+ns+md+nds+ndf+mf;
            console.log();
            salario.set("empleado", pointer);
            salario.set("c", c.toString());
            salario.set("cf", cf.toString());
            salario.set("m",m.toString() );
            salario.set("td", td.toString());
            salario.set("n", n.toString());
            salario.set("nfs", nfs.toString());
            salario.set("t", t.toString());
            salario.set("tf", tf.toString());
            salario.set("cd", cd.toString());
            salario.set("ns", ns.toString());
            salario.set("md", md.toString());
            salario.set("nds", nds.toString());
            salario.set("ndf", ndf.toString());
            salario.set("mf", mf.toString());
            salario.set("anno", ano.toString());
            salario.set("mes", mes.toString());
            salario.set("total", total.toString());
            salario.save(null, {
              success: function(gameScore) {
                clearInput();
                toastr.success('Un momento por favor....', 'Guardardo registro', {timeOut: 5000})
              },
              error: function(gameScore, error) {              
                toastr.error('Error!', 'Error al crear el registro:' + error.message, {timeOut: 5000})
              }
            });
        
     }  
    };

    function clearInput(){
      $("#c").val(0);
      $("#cf").val(0);
      $("#m").val(0);
      $("#td").val(0);   
      $("#n").val(0);
      $("#nfs").val(0);
      $("#t").val(0);
      $("#tf").val(0);
      $("#cd").val(0);
      $("#ns").val(0);
      $("#md").val(0);
      $("#nds").val(0);
      $("#ndf").val(0);
      $("#mf").val(0);

    }

           
  </script>
  </body>
  </html>